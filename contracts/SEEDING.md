# ğŸŒ± Smart Seeding System

One script to rule them all! This smart seeding system is modular, resilient, and idempotent.

## âœ¨ Features

- **Smart Balance Checking**: Only funds accounts that need it
- **Modular Phases**: Run all phases or specific ones
- **Idempotent**: Safe to run multiple times
- **Resilient**: Resume from where you left off if something fails
- **Cost Efficient**: Only pays for what's needed (~20-25 CHZ total)

## ğŸš€ Quick Start

### 1. Setup (One-time)

Generate test wallets:
```bash
./generate_wallets.sh
```

This creates `.env.seed` with 8 test accounts (3 creators + 5 users).

### 2. Seed Everything

```bash
source .env
./seed.sh 0xYourPredictionHubAddress all
```

That's it! The script will:
- Check all account balances
- Fund only accounts that need it
- Run all 6 phases
- Show you a complete summary

## ğŸ“Š Check Status

Before or after seeding, check the status:

```bash
./seed.sh 0xYourPredictionHubAddress status
```

Shows:
- All account balances
- Who is registered as creator
- Deployer balance

## ğŸ”§ Run Specific Phases

If a phase fails, just re-run it:

```bash
# Run specific phase
./seed.sh 0xYourPredictionHubAddress <phase>
```

### Available Phases

| Phase | Description | Cost |
|-------|-------------|------|
| `fund` | Fund accounts only | Variable |
| `creators` | Register 3 creators | ~1.5 CHZ |
| `communities` | Create 3 communities | ~2.0 CHZ |
| `users` | 5 users join communities | ~1.0 CHZ |
| `markets` | Create 6 markets | ~3.0 CHZ |
| `stakes` | Users stake in markets | ~1.5 CHZ |
| `complete` | Complete sample markets | ~2.0 CHZ |
| `status` | Check seeding status | Free |
| `all` | Run everything | ~20-25 CHZ |

### Examples

```bash
# Check status first
./seed.sh 0xAB402727BBaD3bb067E439c3D3fC3C48806422D8 status

# Fund accounts only
./seed.sh 0xAB402727BBaD3bb067E439c3D3fC3C48806422D8 fund

# Register creators
./seed.sh 0xAB402727BBaD3bb067E439c3D3fC3C48806422D8 creators

# Create communities
./seed.sh 0xAB402727BBaD3bb067E439c3D3fC3C48806422D8 communities

# Run everything
./seed.sh 0xAB402727BBaD3bb067E439c3D3fC3C48806422D8 all
```

## ğŸ¯ Typical Workflow

### First Time Seeding

```bash
# 1. Check your deployer has CHZ
source .env
cast balance $(cast wallet address $PRIVATE_KEY) --rpc-url https://spicy-rpc.chiliz.com --ether

# 2. Run full seed
./seed.sh 0xYourHubAddress all
```

### If Something Fails

```bash
# 1. Check status to see what completed
./seed.sh 0xYourHubAddress status

# 2. Re-run the failed phase
./seed.sh 0xYourHubAddress <failed-phase>

# Example: If "markets" phase failed
./seed.sh 0xYourHubAddress markets
```

### Adding More Data Later

```bash
# Add more stakes
./seed.sh 0xYourHubAddress stakes

# Add completed markets
./seed.sh 0xYourHubAddress complete
```

## ğŸ’° Cost Breakdown

| Account | Amount | Purpose |
|---------|--------|---------|
| Creator 1 | 5 CHZ | Register + create community + markets + complete |
| Creator 2 | 4 CHZ | Register + create community + markets |
| Creator 3 | 4 CHZ | Register + create community + markets |
| User 1 | 2 CHZ | Join communities + stake in markets |
| User 2 | 2 CHZ | Join communities + stake in markets |
| User 3 | 1 CHZ | Join community + stake |
| User 4 | 1 CHZ | Join community + stake |
| User 5 | 1 CHZ | Join community + stake |
| **Total** | **~20 CHZ** | + ~3-5 CHZ gas = **~23-25 CHZ** |

## ğŸ” What Gets Seeded

After running `all`, your platform will have:

- âœ… **3 Creators** registered (Sports, Crypto, Politics experts)
- âœ… **3 Communities** active (Sports, Crypto Markets, Political Events)
- âœ… **5 Users** who joined communities
- âœ… **6+ Markets** created (mix of active and completed)
- âœ… **Real Stakes** from users
- âœ… **TVL** (Total Value Locked)
- âœ… **1 Completed Market** with claims demo

## ğŸ› ï¸ Troubleshooting

### "PRIVATE_KEY not set"

```bash
source .env
```

### "Insufficient funds"

Get CHZ from faucet:
```
https://spicy-faucet.chiliz.com
```

### Phase fails with "already registered/exists"

This is normal! The script is idempotent - it skips already-completed steps.

### Want to start completely fresh?

Delete the broadcast history:
```bash
rm -rf broadcast/Seed.s.sol/88882/*
```

Then run again.

### Check gas prices are reasonable

```bash
cast gas-price --rpc-url https://spicy-rpc.chiliz.com
```

The script automatically uses current gas price + 50% buffer (capped at 5000 gwei).

## ğŸ“ Files

- `seed.sh` - The only script you need
- `script/Seed.s.sol` - Solidity seeding logic with modular phases
- `.env` - Your deployer private key
- `.env.seed` - Test wallet keys (generated by `generate_wallets.sh`)
- `generate_wallets.sh` - Generate test wallets (run once)

## ğŸ“ How It Works

1. **Smart Funding**: Checks each account's balance and only sends what's needed
2. **Phase Execution**: Calls specific Solidity functions for each phase
3. **Idempotent**: Uses `isCreator()` and other checks to skip completed steps
4. **Resumable**: Each phase is independent, so you can retry failed ones

## ğŸ’¡ Pro Tips

- Always check `status` before and after seeding
- If unsure, run `fund` first to ensure all accounts have CHZ
- Each phase can be run multiple times safely
- Use specific phases during development to save gas
- The script caps gas price at 5000 gwei for safety

## ğŸš¨ Common Errors & Solutions

| Error | Solution |
|-------|----------|
| "already registered" | Normal! Script skips it automatically |
| "insufficient funds" | Run `./seed.sh <hub> fund` or get more CHZ |
| "replacement transaction underpriced" | Wait a few minutes, then retry |
| "No markets found" | Run markets phase first: `./seed.sh <hub> markets` |

## ğŸ“ Need Help?

Check status first:
```bash
./seed.sh 0xYourHubAddress status
```

This shows all balances and registration states to help debug.

---

**Happy Seeding! ğŸŒ±**

